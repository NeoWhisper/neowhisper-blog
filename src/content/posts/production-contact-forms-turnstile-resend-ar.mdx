---
title: "بناء نماذج اتصال جاهزة للإنتاج باستخدام Cloudflare Turnstile وResend"
date: "2026-02-09"
excerpt: "تجنب السبام ومشاكل التسليم. إليك كيفية بناء نموذج اتصال يعمل فعلياً في الإنتاج، باستخدام Turnstile للحماية وResend للتسليم الموثوق."
category: "Next.js"
coverImage: "/images/contact-form-cover.png"
author:
  name: "NeoWhisper"
  picture: "/images/author.png"
---

من المفترض أن تكون نماذج الاتصال بسيطة. حتى تنشرها في بيئة الإنتاج.

ثم تبدأ رسائل السبام بالتدفق. تهبط الرسائل في مجلد السبام. يرسل المستخدمون نماذج فارغة. يصبح صندوق الوارد فوضى من إرساليات البوتات وصفر استفسارات حقيقية.

لقد أعدت بناء [نموذج الاتصال](/contact?lang=ar) لهذا الموقع للتو، وسأريك بالضبط كيفية صنع نموذج يعمل فعلياً. لا كلام نظري—فقط الأنماط المهمة عندما يبدأ المستخدمون الحقيقيون (والبوتات الحقيقية) في استخدام النموذج.

---

## المشكلة مع نماذج الاتصال "البسيطة"

نموذج اتصال أساسي سهل البرمجة، لكنه يفشل في الإنتاج لأربعة أسباب رئيسية:

1. **بوتات السبام** ستغرقه في غضون ساعات من الإطلاق.
2. **توصيل البريد الإلكتروني** كابوس (Gmail يصنفك كسبام).
3. **لا توجد ملاحظات** عند فشل شيء على جانب الخادم.
4. **تحسين تدريجي صفر** (يتعطل بدون JavaScript).

<Callout type="warning">
  تحتاج إلى حماية حقيقية من السبام (وليس honeypot يتجاوزه البوتات في 2026)،
  وتوصيل بريد إلكتروني موثوق (SPF، DKIM، DMARC)، وتجربة مستخدم قوية.
</Callout>

---

## لماذا Cloudflare Turnstile + Resend؟

**Cloudflare Turnstile** هو reCAPTCHA بدون تتبع Google. إنه غير مرئي لمعظم المستخدمين، مجاني للأحجام المعقولة، ويوقف البوتات فعلياً.

**Resend** هو البديل الحديث لـ SendGrid/Mailgun. واجهة برمجة نظيفة، قابلية توصيل ممتازة، وتسعير معقول.

---

<Step number="١" title="إضافة Turnstile إلى النموذج">

أولاً، احصل على مفتاح موقع Turnstile من [Cloudflare](https://dash.cloudflare.com/?to=/:account/turnstile).

أضفه إلى `.env.local`:

```bash
NEXT_PUBLIC_TURNSTILE_SITE_KEY=your-site-key
TURNSTILE_SECRET_KEY=your-secret-key
```

ثم أضف الأداة إلى النموذج:

```tsx
"use client";

export default function ContactForm() {
  return (
    <form method="POST" action="/api/contact">
      <input name="name" required />
      <input name="email" type="email" required />
      <textarea name="details" required />

      {/* تحدي Turnstile */}
      <div
        className="cf-turnstile"
        data-sitekey={process.env.NEXT_PUBLIC_TURNSTILE_SITE_KEY}
      />

      <button type="submit">إرسال</button>

      <script
        src="https://challenges.cloudflare.com/turnstile/v0/api.js"
        async
        defer
      />
    </form>
  );
}
```

</Step>

<Step number="٢" title="التحقق من الرمز على جانب الخادم">

في مسار API الخاص بك، تحقق من الرمز قبل إرسال أي بريد إلكتروني. **تحقق دائماً على جانب الخادم—يمكن تزوير رموز العميل.**

```tsx
export async function POST(request: Request) {
  const formData = await request.formData();
  const turnstileToken = formData.get("cf-turnstile-response");

  if (!turnstileToken) {
    return NextResponse.json(
      { ok: false, message: "فشل التحقق من السبام." },
      { status: 400 },
    );
  }

  // التحقق مع Cloudflare
  const verifyResponse = await fetch(
    "https://challenges.cloudflare.com/turnstile/v0/siteverify",
    {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({
        secret: process.env.TURNSTILE_SECRET_KEY,
        response: turnstileToken,
      }),
    },
  );

  const verifyData = await verifyResponse.json();

  if (!verifyData.success) {
    return NextResponse.json(
      { ok: false, message: "فشل التحقق من السبام." },
      { status: 400 },
    );
  }
}
```

</Step>

<Step number="٣" title="إرسال البريد باستخدام Resend">

احصل على مفتاح API الخاص بك من [Resend](https://resend.com/api-keys) وأرسل البريد باستخدام واجهتهم البسيطة:

```tsx
const emailPayload = {
  from: process.env.RESEND_FROM,
  to: [process.env.RESEND_TO],
  subject: `استفسار جديد من ${formData.get("name")}`,
  reply_to: formData.get("email"),
  text: `الاسم: ${formData.get("name")}\nالبريد: ${formData.get("email")}\n\n${formData.get("details")}`,
};

const emailResponse = await fetch("https://api.resend.com/emails", {
  method: "POST",
  headers: {
    Authorization: `Bearer ${process.env.RESEND_API_KEY}`,
    "Content-Type": "application/json",
  },
  body: JSON.stringify(emailPayload),
});
```

</Step>

<Step number="٤" title="إصلاح قابلية توصيل البريد">

إرسال بريد إلكتروني سهل. وصوله إلى صندوق الوارد هو الصعب. تحتاج إلى ثلاثة سجلات DNS:

<Callout type="info">

**متطلبات DNS:**

- **SPF:** `v=spf1 include:_spf.resend.com ~all`
- **DKIM:** يتم إنشاؤه في لوحة تحكم Resend.
- **DMARC:** `v=DMARC1; p=quarantine; rua=mailto:postmaster@yourdomain.com; pct=100; adkim=s; aspf=s`

</Callout>

بدون هذه السجلات، سيصنف Gmail/Outlook رسائلك كسبام أو يرفضها تماماً. تعلمت هذا بالطريقة الصعبة—[نموذج الاتصال](/contact?lang=ar) الخاص بنا لم يعمل لأسابيع حتى أضفنا DMARC.

</Step>

<Step number="٥" title="واجهة مستخدم متقدمة">

### التحسين التدريجي

يجب أن يعمل النموذج حتى لو فشل تحميل JavaScript. استخدم المنصة من خلال اكتشاف نوع المحتوى في مسار API الخاص بك:

```tsx
const contentType = request.headers.get("content-type") ?? "";
const isFormSubmit = contentType.includes("application/x-www-form-urlencoded");

if (isFormSubmit) {
  return NextResponse.redirect(
    new URL("/contact?success=1&lang=ar", request.url),
    303,
  );
}
```

### تعامل محدد مع الأخطاء

لا ترجع فقط رسائل عامة. كن محدداً في ما حدث خطأ (حقول مفقودة، بريد غير صالح، فشل فحص الأمان) لمساعدة المستخدم في إصلاحه.

</Step>

---

## قائمة الاختبار النهائية

<Checklist>
  <CheckItem>اختبر Turnstile مع وبدون إكمال التحدي</CheckItem>
  <CheckItem>تحقق من جميع سجلات DNS باستخدام MXToolbox</CheckItem>
  <CheckItem>اختبر قابلية التوصيل لـ Gmail و Outlook و Yahoo</CheckItem>
  <CheckItem>
    عطل JavaScript وتأكد من أن النموذج لا يزال يرسل بشكل صحيح
  </CheckItem>
  <CheckItem>تحقق من سجلات الخادم لأي أخطاء غير ملتقطة من Resend API</CheckItem>
</Checklist>

---

**هل تحتاج مساعدة في بناء نموذج اتصال جاهز للإنتاج لموقعك؟** نحن متخصصون في تطوير Next.js مع معالجة جميع التفاصيل—من حماية السبام إلى قابلية توصيل البريد. تحقق من [خدماتنا](/services?lang=ar) أو [تواصل معنا](/contact?lang=ar) لمناقشة مشروعك.

---

**ذات صلة:** إذا كنت تبني مواقع متعددة اللغات، تحقق من دليلنا حول [شحن مواقع Next.js الجاهزة لـ AdSense](/blog/adsense-ready-multilingual-nextjs?lang=ar) مع التعريب المناسب.
